{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/components/HeaderBar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\n// Tipe data user sesuai backend\r\ninterface User {\r\n  id: string;\r\n  username: string;\r\n  role: \"user\" | \"admin\";\r\n  fullName?: string;\r\n  email: string;\r\n  avatarUrl?: string;\r\n}\r\n\r\nexport default function HeaderBar() {\r\n  const router = useRouter();\r\n  const [user, setUser] = useState<User | null>(null);\r\n\r\n  useEffect(() => {\r\n    const stored = localStorage.getItem(\"user\");\r\n    if (stored) {\r\n      try {\r\n        const parsed = JSON.parse(stored) as User;\r\n        setUser(parsed);\r\n      } catch (error) {\r\n        console.error(\"Gagal parsing user dari localStorage:\", error);\r\n        localStorage.removeItem(\"user\");\r\n        localStorage.removeItem(\"authToken\");\r\n        router.push(\"/login\");\r\n      }\r\n    } else {\r\n      // Jika tidak ada user, redirect ke login\r\n      router.push(\"/login\");\r\n    }\r\n  }, [router]);\r\n\r\n  const handleLogout = () => {\r\n    if (confirm(\"Yakin ingin logout?\")) {\r\n      // Hapus data autentikasi\r\n      localStorage.removeItem(\"authToken\");\r\n      localStorage.removeItem(\"user\");\r\n\r\n      // Log aktivitas logout\r\n      console.log(\"User logout\");\r\n\r\n      // Redirect\r\n      router.push(\"/login\");\r\n    }\r\n  };\r\n\r\n  if (!user) {\r\n    return null; // Atau loading spinner\r\n  }\r\n\r\n  const displayName = user.fullName || user.username || \"Pengguna\";\r\n\r\n  return (\r\n    <header className=\"flex items-center justify-between bg-white border-b border-gray-200 px-4 py-3 shadow-sm\">\r\n      {/* Kiri: Logo + Nama Web */}\r\n      <div className=\"flex items-center space-x-3\">\r\n        <img src=\"/Logo.svg\" alt=\"Logo Jangkar\" className=\"h-8 w-8\" />\r\n        <span className=\"text-lg font-semibold text-blue-800\">Vision Traffic Suite</span>\r\n      </div>\r\n\r\n      {/* Kanan: Status + Nama + Admin Button (jika admin) + Logout */}\r\n      <div className=\"flex items-center space-x-3 text-sm\">\r\n        <img src=\"/Active.svg\" alt=\"User Active\" className=\"h-4 w-4 animate-pulse\" title=\"Pengguna aktif\" />\r\n        <span className=\"text-slate-800 font-medium\">{displayName}</span>\r\n\r\n        {/* üîß Tombol Admin - Hanya muncul untuk admin */}\r\n        {user.role === \"admin\" && (\r\n          <>\r\n            <span className=\"text-gray-300\">|</span>\r\n            <button onClick={() => router.push(\"/admin\")} className=\"text-blue-600 hover:underline font-medium\" title=\"Masuk ke panel admin\">\r\n              üõ†Ô∏è Admin Panel\r\n            </button>\r\n          </>\r\n        )}\r\n\r\n        <span className=\"text-gray-300\">|</span>\r\n        <button onClick={handleLogout} className=\"text-red-500 hover:underline\" title=\"Keluar dari sistem\">\r\n          Logout\r\n        </button>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAHA;;;AAee,SAAS;;IACtB,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAe;IAE9C,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;+BAAE;YACR,MAAM,SAAS,aAAa,OAAO,CAAC;YACpC,IAAI,QAAQ;gBACV,IAAI;oBACF,MAAM,SAAS,KAAK,KAAK,CAAC;oBAC1B,QAAQ;gBACV,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,yCAAyC;oBACvD,aAAa,UAAU,CAAC;oBACxB,aAAa,UAAU,CAAC;oBACxB,OAAO,IAAI,CAAC;gBACd;YACF,OAAO;gBACL,yCAAyC;gBACzC,OAAO,IAAI,CAAC;YACd;QACF;8BAAG;QAAC;KAAO;IAEX,MAAM,eAAe;QACnB,IAAI,QAAQ,wBAAwB;YAClC,yBAAyB;YACzB,aAAa,UAAU,CAAC;YACxB,aAAa,UAAU,CAAC;YAExB,uBAAuB;YACvB,QAAQ,GAAG,CAAC;YAEZ,WAAW;YACX,OAAO,IAAI,CAAC;QACd;IACF;IAEA,IAAI,CAAC,MAAM;QACT,OAAO,MAAM,uBAAuB;IACtC;IAEA,MAAM,cAAc,KAAK,QAAQ,IAAI,KAAK,QAAQ,IAAI;IAEtD,qBACE,6LAAC;QAAO,WAAU;;0BAEhB,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,KAAI;wBAAY,KAAI;wBAAe,WAAU;;;;;;kCAClD,6LAAC;wBAAK,WAAU;kCAAsC;;;;;;;;;;;;0BAIxD,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,KAAI;wBAAc,KAAI;wBAAc,WAAU;wBAAwB,OAAM;;;;;;kCACjF,6LAAC;wBAAK,WAAU;kCAA8B;;;;;;oBAG7C,KAAK,IAAI,KAAK,yBACb;;0CACE,6LAAC;gCAAK,WAAU;0CAAgB;;;;;;0CAChC,6LAAC;gCAAO,SAAS,IAAM,OAAO,IAAI,CAAC;gCAAW,WAAU;gCAA4C,OAAM;0CAAuB;;;;;;;;kCAMrI,6LAAC;wBAAK,WAAU;kCAAgB;;;;;;kCAChC,6LAAC;wBAAO,SAAS;wBAAc,WAAU;wBAA+B,OAAM;kCAAqB;;;;;;;;;;;;;;;;;;AAM3G;GAxEwB;;QACP,qIAAA,CAAA,YAAS;;;KADF","debugId":null}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/components/SidebarLeft.tsx"],"sourcesContent":["// src/components/SidebarLeft.tsx\r\n\"use client\";\r\n\r\nimport { useTool } from \"@/context/ToolContext\";\r\nimport { useData } from \"@/context/DataContext\";\r\nimport { MapIcon, BeakerIcon, CursorArrowRaysIcon, WrenchScrewdriverIcon, RectangleStackIcon } from \"@heroicons/react/24/outline\";\r\nimport type { Tool } from \"@/context/ToolContext\";\r\n\r\nexport default function SidebarLeft() {\r\n  const { activeTool, setActiveTool } = useTool();\r\n  const { layerDefinitions, layerVisibility, setLayerVisibility, loadingLayers, errorLayers } = useData();\r\n\r\n  // üîß Tools (bisa dari backend nanti)\r\n  const toolOptions: {\r\n    value: Tool;\r\n    label: string;\r\n    icon: React.ElementType;\r\n    tooltip: string;\r\n  }[] = [\r\n    {\r\n      value: \"toponimi\",\r\n      label: \"Tambah Toponimi\",\r\n      icon: MapIcon,\r\n      tooltip: \"Menambahkan nama tempat di sungai\",\r\n    },\r\n    {\r\n      value: \"simulasi\",\r\n      label: \"Simulasi Akuisisi Data\",\r\n      icon: CursorArrowRaysIcon,\r\n      tooltip: \"Membuat transek otomatis dari garis tengah sungai\",\r\n    },\r\n    {\r\n      value: \"echosounder\",\r\n      label: \"Visualisasi Echosounder\",\r\n      icon: BeakerIcon,\r\n      tooltip: \"Menampilkan data echosounder\",\r\n    },\r\n  ];\r\n\r\n  // ‚úÖ Toggle visibilitas layer (per item)\r\n  const handleLayerVisibilityChange = (layerId: string) => {\r\n    setLayerVisibility(layerId, !layerVisibility[layerId]);\r\n\r\n    // ‚úÖ Simpan ke localStorage\r\n    try {\r\n      const newVisibility = { ...layerVisibility, [layerId]: !layerVisibility[layerId] };\r\n      localStorage.setItem(\"layerVisibility\", JSON.stringify(newVisibility));\r\n    } catch (err) {\r\n      console.warn(\"Gagal simpan layerVisibility ke localStorage\", err);\r\n    }\r\n  };\r\n\r\n  // ‚úÖ Reset semua layer visibility\r\n  const handleResetLayers = () => {\r\n    if (!Array.isArray(layerDefinitions)) return;\r\n\r\n    const reset = layerDefinitions.reduce((acc, layer) => {\r\n      setLayerVisibility(layer.id, false); // Reset via context\r\n      return { ...acc, [layer.id]: false };\r\n    }, {} as Record<string, boolean>);\r\n\r\n    try {\r\n      localStorage.setItem(\"layerVisibility\", JSON.stringify(reset));\r\n    } catch (err) {\r\n      console.warn(\"Gagal reset localStorage\", err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full w-72 border-r bg-white text-sm text-gray-800 shadow-md flex flex-col\">\r\n      <div className=\"p-4 space-y-6 flex-1 overflow-y-auto\">\r\n        {/* Layer List */}\r\n        <div>\r\n          <h2 className=\"flex items-center gap-2 mb-3 font-semibold border-b pb-1 text-base\">\r\n            <RectangleStackIcon className=\"w-4 h-4\" />\r\n            Layer List\r\n          </h2>\r\n\r\n          {/* Loading */}\r\n          {loadingLayers && (\r\n            <div className=\"flex items-center justify-center py-2\">\r\n              <span className=\"text-gray-500 text-sm\">Memuat layer...</span>\r\n            </div>\r\n          )}\r\n\r\n          {/* Error */}\r\n          {errorLayers && !loadingLayers && (\r\n            <div className=\"text-center py-2\">\r\n              <p className=\"text-red-500 text-sm\">‚ùå {errorLayers}</p>\r\n              <button onClick={() => window.location.reload()} className=\"text-xs text-blue-500 hover:underline mt-1\">\r\n                Coba lagi\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Data Tersedia */}\r\n          {!loadingLayers && !errorLayers && Array.isArray(layerDefinitions) && layerDefinitions.length > 0 && (\r\n            <div className=\"space-y-2\">\r\n              {layerDefinitions.map((layer) => (\r\n                <label key={layer.id} className=\"flex items-center justify-between hover:bg-gray-100 p-2 rounded-md transition cursor-pointer group\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input type=\"checkbox\" className=\"accent-cyan-600 w-4 h-4\" checked={layerVisibility[layer.id] ?? false} onChange={() => handleLayerVisibilityChange(layer.id)} />\r\n                    <span className=\"font-medium\">{layer.name}</span>\r\n                  </div>\r\n                  <span className=\"text-gray-400 text-xs group-hover:text-gray-700\" title={layer.description || \"Tidak ada deskripsi\"}>\r\n                    ‚ÑπÔ∏è\r\n                  </span>\r\n                </label>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {/* Tidak Ada Data */}\r\n          {!loadingLayers && !errorLayers && (!Array.isArray(layerDefinitions) || layerDefinitions.length === 0) && (\r\n            <div className=\"text-center py-2\">\r\n              <p className=\"text-gray-500 text-sm\">Tidak ada layer tersedia.</p>\r\n              <button onClick={handleResetLayers} className=\"text-xs text-blue-500 hover:underline mt-1\">\r\n                Reset visibilitas\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Tool Selector */}\r\n        <div>\r\n          <h2 className=\"flex items-center gap-2 mb-3 font-semibold border-b pb-1 text-base\">\r\n            <WrenchScrewdriverIcon className=\"w-4 h-4\" />\r\n            Tools\r\n          </h2>\r\n          <div className=\"space-y-2\">\r\n            {toolOptions.map(({ value, label, icon: Icon, tooltip }) => (\r\n              <button\r\n                key={`tool-${value}`}\r\n                title={tooltip}\r\n                onClick={() => setActiveTool(value)}\r\n                className={`flex items-center w-full gap-2 p-2 rounded-md transition text-left hover:bg-indigo-50 ${activeTool === value ? \"bg-indigo-100 font-semibold text-indigo-700\" : \"text-gray-700\"}`}\r\n              >\r\n                <Icon className=\"w-4 h-4\" />\r\n                <span>{label}</span>\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 490, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/components/SidebarRight.tsx"],"sourcesContent":["// src/components/SidebarRight.tsx\r\n\"use client\";\r\n\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { Line } from \"react-chartjs-2\";\r\nimport { Chart as ChartJS, CategoryScale, LinearScale, PointElement, LineElement, Tooltip, Legend, Filler, ChartOptions } from \"chart.js\";\r\nimport { useData } from \"@/context/DataContext\";\r\n\r\nChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Tooltip, Legend, Filler);\r\n\r\n// === Tipe Data ===\r\ninterface Transect {\r\n  id: string;\r\n  name: string;\r\n  length: number;\r\n  avgDepth: number;\r\n}\r\n\r\ninterface SurveyGroup {\r\n  surveyId: string;\r\n  date: string;\r\n  transects: Transect[];\r\n  source: string;\r\n}\r\n\r\ninterface SamplingPoint {\r\n  surveyId: string;\r\n  distance: number;\r\n  depth: number;\r\n}\r\n\r\nexport default function SidebarRight() {\r\n  const [activeTab, setActiveTab] = useState<\"field\" | \"simulated\">(\"field\");\r\n  const [surveyGroups, setSurveyGroups] = useState<SurveyGroup[]>([]);\r\n  const [selectedSurveyIds, setSelectedSurveyIds] = useState<string[]>([]);\r\n  const [allData, setAllData] = useState<Record<string, SamplingPoint[]>>({});\r\n  const [loading, setLoading] = useState(true);\r\n  const [loadingPoints, setLoadingPoints] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n\r\n  const { dataVersion, surveyListVersion } = useData(); // gunakan surveyListVersion\r\n  const itemsPerPage = 5;\r\n\r\n  // --- Helper: Ambil token ---\r\n  const getAuthHeaders = () => {\r\n    const token = localStorage.getItem(\"authToken\");\r\n    return {\r\n      \"Content-Type\": \"application/json\",\r\n      ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n    };\r\n  };\r\n\r\n  // === 1. Tab \"Data Lapangan\": Ambil dari localStorage ===\r\n  useEffect(() => {\r\n    if (activeTab === \"field\") {\r\n      try {\r\n        const saved = localStorage.getItem(\"fieldSurveys\");\r\n        const surveys: SurveyGroup[] = saved ? JSON.parse(saved) : [];\r\n        setSurveyGroups(surveys);\r\n      } catch (err) {\r\n        console.error(\"‚ùå Gagal baca fieldSurveys dari localStorage:\", err);\r\n        setSurveyGroups([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n  }, [activeTab, surveyListVersion]);\r\n\r\n  // === 2. Tab \"Simulasi\": Ambil dari GraphQL (seperti sebelumnya) ===\r\n  useEffect(() => {\r\n    if (activeTab === \"simulated\") {\r\n      const fetchSurveyGroups = async () => {\r\n        setLoading(true);\r\n        try {\r\n          const res = await fetch(\"http://localhost:5000/graphql\", {\r\n            method: \"POST\",\r\n            headers: getAuthHeaders(),\r\n            body: JSON.stringify({\r\n              query: `\r\n                query GetSimulatedSurveys {\r\n                  spatialFeatures(layerType: \"valid_sampling_point\") {\r\n                    meta\r\n                    source\r\n                  }\r\n                }\r\n              `,\r\n            }),\r\n          });\r\n\r\n          const data = await res.json();\r\n          if (data.errors) throw new Error(data.errors[0].message);\r\n\r\n          const features = data.data?.spatialFeatures || [];\r\n          const grouped: Record<string, SurveyGroup> = {};\r\n\r\n          features.forEach((item: any) => {\r\n            const meta = item.meta || {};\r\n            const surveyId = meta.survey_id || meta.surveyId || meta.SURVEY_ID || item.surveyId;\r\n            if (!surveyId || item.source === \"import\") return;\r\n\r\n            if (!grouped[surveyId]) {\r\n              grouped[surveyId] = {\r\n                surveyId,\r\n                date: meta.survey_date || \"N/A\",\r\n                transects: [],\r\n                source: item.source || \"drawing\",\r\n              };\r\n            }\r\n          });\r\n\r\n          setSurveyGroups(Object.values(grouped));\r\n        } catch (err) {\r\n          console.error(\"‚ùå Gagal muat simulasi:\", err);\r\n          alert(\"Gagal muat data simulasi.\");\r\n          setSurveyGroups([]);\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      };\r\n\r\n      fetchSurveyGroups();\r\n    }\r\n  }, [activeTab, dataVersion]);\r\n\r\n  // --- Reset saat ganti tab ---\r\n  useEffect(() => {\r\n    setSelectedSurveyIds([]);\r\n    setCurrentPage(1);\r\n  }, [activeTab]);\r\n\r\n  // --- Ambil titik untuk chart ---\r\n  useEffect(() => {\r\n    const fetchAllPoints = async () => {\r\n      if (selectedSurveyIds.length === 0) {\r\n        setAllData({});\r\n        return;\r\n      }\r\n\r\n      setLoadingPoints(true);\r\n      const newData: Record<string, SamplingPoint[]> = {};\r\n\r\n      try {\r\n        for (const surveyId of selectedSurveyIds) {\r\n          const survey = surveyGroups.find((s) => s.surveyId === surveyId);\r\n          if (!survey) continue;\r\n\r\n          const isFieldData = survey.source === \"import\";\r\n          const query = isFieldData\r\n            ? `query GetFieldPoints($surveyId: String!) { fieldSurveyPointsBySurveyId(surveyId: $surveyId) { meta } }`\r\n            : `query GetSimulatedPoints($surveyId: String!) { samplingPointsBySurveyId(surveyId: $surveyId) { meta } }`;\r\n\r\n          const res = await fetch(\"http://localhost:5000/graphql\", {\r\n            method: \"POST\",\r\n            headers: getAuthHeaders(),\r\n            body: JSON.stringify({ query, variables: { surveyId } }),\r\n          });\r\n\r\n          const result = await res.json();\r\n          if (result.errors) continue;\r\n\r\n          const points = result.data?.[Object.keys(result.data)[0]] || [];\r\n          const processedPoints = points\r\n            .map((p: any) => {\r\n              const meta = p.meta || {};\r\n              const depth = parseFloat(meta.kedalaman ?? meta.depth ?? meta.depth_value ?? 0);\r\n              const distance = parseFloat(meta.jarak ?? meta.distance_m ?? meta.distance ?? 0);\r\n              return isNaN(depth) || isNaN(distance) ? null : { surveyId, distance: Math.round(distance * 100) / 100, depth: Math.abs(depth) };\r\n            })\r\n            .filter(Boolean) as SamplingPoint[];\r\n\r\n          processedPoints.sort((a, b) => a.distance - b.distance);\r\n          newData[surveyId] = processedPoints;\r\n        }\r\n\r\n        setAllData(newData);\r\n      } catch (err) {\r\n        console.error(\"‚ùå Gagal muat titik:\", err);\r\n      } finally {\r\n        setLoadingPoints(false);\r\n      }\r\n    };\r\n\r\n    fetchAllPoints();\r\n  }, [selectedSurveyIds, surveyGroups]);\r\n\r\n  // --- Sumbu X ---\r\n  const allDistances = useMemo(() => {\r\n    const distances = new Set<number>();\r\n    Object.values(allData).forEach((points) => points.forEach((p) => distances.add(p.distance)));\r\n    return Array.from(distances).sort((a, b) => a - b);\r\n  }, [allData]);\r\n\r\n  // --- Data Chart ---\r\n  const chartData = useMemo(() => {\r\n    const datasets = selectedSurveyIds.map((surveyId, idx) => {\r\n      const points = allData[surveyId] || [];\r\n      const colorHue = (idx * 130) % 360;\r\n      const borderColor = `hsl(${colorHue}, 70%, 50%)`;\r\n      const backgroundColor = `hsl(${colorHue}, 70%, 50%, 0.2)`;\r\n\r\n      const data = allDistances.map((dist) => {\r\n        const point = points.find((p) => Math.abs(p.distance - dist) < 0.5);\r\n        return point ? point.depth : null;\r\n      });\r\n\r\n      return {\r\n        label: `Survey ${surveyId.slice(-6)}`,\r\n        data,\r\n        borderColor,\r\n        backgroundColor,\r\n        fill: true,\r\n        tension: 0.4,\r\n        pointRadius: 4,\r\n      };\r\n    });\r\n\r\n    return {\r\n      labels: allDistances.map((d) => d.toFixed(0)),\r\n      datasets,\r\n    };\r\n  }, [allDistances, allData, selectedSurveyIds]);\r\n\r\n  // --- Opsi Chart ---\r\n  const chartOptions: ChartOptions<\"line\"> = {\r\n    responsive: true,\r\n    maintainAspectRatio: false,\r\n    plugins: {\r\n      legend: { position: \"top\", labels: { usePointStyle: true, boxWidth: 6, padding: 12, font: { size: 11 } } },\r\n      tooltip: {\r\n        mode: \"index\",\r\n        intersect: false,\r\n        backgroundColor: \"rgba(0,0,0,0.8)\",\r\n        titleColor: \"#fff\",\r\n        bodyColor: \"#ccc\",\r\n        callbacks: {\r\n          label: (ctx) => `${ctx.dataset?.label}: ${ctx.parsed.y} m`,\r\n        },\r\n      },\r\n    },\r\n    scales: {\r\n      y: { reverse: true, title: { display: true, text: \"Kedalaman (m)\" }, ticks: { stepSize: 1 } },\r\n      x: { title: { display: true, text: \"Jarak dari Awal Transek (m)\" } },\r\n    },\r\n  };\r\n\r\n  // === Filter dan Pagination ===\r\n  const filteredSurveyGroups = useMemo(() => {\r\n    return surveyGroups.filter((s) => (activeTab === \"field\" ? s.source === \"import\" : s.source !== \"import\"));\r\n  }, [surveyGroups, activeTab]);\r\n\r\n  const totalPages = Math.ceil(filteredSurveyGroups.length / itemsPerPage);\r\n  const currentSurveys = filteredSurveyGroups.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);\r\n\r\n  // === Render UI ===\r\n  return (\r\n    <div className=\"p-4 w-full space-y-6 bg-gradient-to-br from-slate-50 to-white rounded-xl shadow-lg h-full overflow-y-auto border border-slate-200\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <h2 className=\"font-bold text-xl text-slate-800 flex items-center gap-2\">\r\n          <span className=\"text-blue-600\">üìä</span>\r\n          Perbandingan Penampang Transek\r\n        </h2>\r\n        <div className=\"flex space-x-1 bg-slate-100 rounded-lg p-1\">\r\n          <button onClick={() => setActiveTab(\"field\")} className={`px-3 py-1 text-sm font-medium rounded-md transition ${activeTab === \"field\" ? \"bg-blue-500 text-white shadow\" : \"text-slate-600 hover:bg-slate-200\"}`}>\r\n            üì• Data Lapangan\r\n          </button>\r\n          <button onClick={() => setActiveTab(\"simulated\")} className={`px-3 py-1 text-sm font-medium rounded-md transition ${activeTab === \"simulated\" ? \"bg-blue-500 text-white shadow\" : \"text-slate-600 hover:bg-slate-200\"}`}>\r\n            üñåÔ∏è Simulasi\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Select Survey */}\r\n      <div className=\"space-y-3\">\r\n        <label className=\"block text-sm font-semibold text-slate-700\">Pilih Survey ({activeTab === \"field\" ? \"Lapangan\" : \"Simulasi\"})</label>\r\n\r\n        {loading ? (\r\n          <p className=\"text-sm text-slate-500 italic\">Memuat daftar...</p>\r\n        ) : filteredSurveyGroups.length === 0 ? (\r\n          <p className=\"text-sm text-slate-400 italic\">{activeTab === \"field\" ? \"Belum ada data upload.\" : \"Tidak ada data simulasi.\"}</p>\r\n        ) : (\r\n          <>\r\n            <div className=\"overflow-x-auto border rounded-lg bg-white shadow-sm\">\r\n              <table className=\"min-w-full divide-y divide-slate-200\">\r\n                <thead className=\"bg-slate-50\">\r\n                  <tr>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={selectedSurveyIds.length > 0 && selectedSurveyIds.every((id) => filteredSurveyGroups.some((s) => s.surveyId === id))}\r\n                        onChange={(e) => setSelectedSurveyIds(e.target.checked ? filteredSurveyGroups.map((s) => s.surveyId) : [])}\r\n                        className=\"rounded border-slate-300 text-blue-600 focus:ring-blue-500\"\r\n                      />\r\n                    </th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider\">Survey ID</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider\">Tanggal</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider\">Titik</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-slate-200\">\r\n                  {currentSurveys.map((survey) => (\r\n                    <tr key={survey.surveyId} className={`transition-all hover:bg-blue-50 cursor-pointer ${selectedSurveyIds.includes(survey.surveyId) ? \"bg-blue-50 border-l-4 border-blue-400\" : \"\"}`}>\r\n                      <td className=\"px-4 py-3\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={selectedSurveyIds.includes(survey.surveyId)}\r\n                          onChange={() => setSelectedSurveyIds((prev) => (prev.includes(survey.surveyId) ? prev.filter((id) => id !== survey.surveyId) : [...prev, survey.surveyId]))}\r\n                          className=\"rounded border-slate-300 text-blue-600 focus:ring-blue-500\"\r\n                        />\r\n                      </td>\r\n                      <td className=\"px-4 py-3 font-mono text-sm text-slate-800\">SURVEY...{survey.surveyId.slice(-6)}</td>\r\n                      <td className=\"px-4 py-3 text-sm text-slate-500\">{survey.date}</td>\r\n                      <td className=\"px-4 py-3 text-sm text-slate-500\">{allData[survey.surveyId]?.length || 0}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n\r\n            {/* Pagination */}\r\n            <div className=\"flex items-center justify-between text-sm text-slate-600\">\r\n              <p>\r\n                Menampilkan <span className=\"font-medium\">{currentSurveys.length}</span> dari <span className=\"font-medium\">{filteredSurveyGroups.length}</span>\r\n              </p>\r\n              <div className=\"flex items-center space-x-2\">\r\n                <button\r\n                  onClick={() => setCurrentPage((prev) => Math.max(prev - 1, 1))}\r\n                  disabled={currentPage === 1}\r\n                  className={`px-3 py-1 rounded border ${currentPage === 1 ? \"bg-slate-100 text-slate-400\" : \"bg-white text-slate-700 hover:bg-slate-50\"}`}\r\n                >\r\n                  Previous\r\n                </button>\r\n                <span>\r\n                  {currentPage} / {totalPages}\r\n                </span>\r\n                <button\r\n                  onClick={() => setCurrentPage((prev) => Math.min(prev + 1, totalPages))}\r\n                  disabled={currentPage === totalPages}\r\n                  className={`px-3 py-1 rounded border ${currentPage === totalPages ? \"bg-slate-100 text-slate-400\" : \"bg-white text-slate-700 hover:bg-slate-50\"}`}\r\n                >\r\n                  Next\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n        <p className=\"text-xs text-slate-500\">Pilih survey untuk membandingkan profil dasar.</p>\r\n      </div>\r\n\r\n      {/* Chart */}\r\n      <div className=\"flex-1 h-80 bg-white p-4 rounded-lg shadow-inner\">\r\n        <h3 className=\"font-semibold mb-3 text-slate-700\">Grafik Profil Dasar</h3>\r\n        {loadingPoints ? (\r\n          <div className=\"flex items-center justify-center h-64\">\r\n            <p className=\"text-sm text-slate-500\">üìä Memuat data...</p>\r\n          </div>\r\n        ) : selectedSurveyIds.length === 0 ? (\r\n          <div className=\"flex items-center justify-center h-64 text-slate-400\">\r\n            <p className=\"italic\">Pilih survey dari tab \"{activeTab === \"field\" ? \"Data Lapangan\" : \"Simulasi\"}\".</p>\r\n          </div>\r\n        ) : (\r\n          <Line data={chartData} options={chartOptions} />\r\n        )}\r\n      </div>\r\n\r\n      {/* Statistik */}\r\n      {selectedSurveyIds.length > 0 && (\r\n        <div className=\"text-sm text-slate-600 space-y-1 border-t pt-3 border-slate-200\">\r\n          <p>\r\n            <strong>‚úÖ Survey Dipilih:</strong> {selectedSurveyIds.length}\r\n          </p>\r\n          <p>\r\n            <strong>üìä Total Titik:</strong> {Object.values(allData).flat().length}\r\n          </p>\r\n          {allDistances.length > 0 && (\r\n            <p>\r\n              <strong>üìè Jarak Maks:</strong> {Math.max(...allDistances)} m\r\n            </p>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1250, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/components/BottomPanel.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { MaterialReactTable, type MRT_ColumnDef } from \"material-react-table\";\r\nimport { Box, IconButton, Tooltip, CircularProgress } from \"@mui/material\";\r\nimport { Refresh } from \"@mui/icons-material\";\r\nimport { useData } from \"@/context/DataContext\";\r\nimport { Feature } from \"geojson\";\r\n\r\n// --- Utility: Flatten feature ---\r\nfunction flattenFeature(feature: Feature, layerName: string) {\r\n  const { properties = {}, geometry } = feature;\r\n  return {\r\n    layer: layerName,\r\n    geomType: geometry?.type || \"Unknown\",\r\n    ...properties,\r\n  };\r\n}\r\n\r\n// --- GraphQL Fetch Function ---\r\nasync function fetchFreshAttributes(visibleLayerTypes: string[]): Promise<Feature[]> {\r\n  try {\r\n    const response = await fetch(\"http://localhost:5000/graphql\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        query: `\r\n          query GetFeaturesByLayerTypes($layerTypes: [String!]!) {\r\n            featuresByLayerTypes(layerTypes: $layerTypes) {\r\n              type\r\n              geometry\r\n              properties\r\n            }\r\n          }\r\n        `,\r\n        variables: { layerTypes: visibleLayerTypes },\r\n      }),\r\n    });\r\n\r\n    const result = await response.json();\r\n    return result.data?.featuresByLayerTypes || [];\r\n  } catch (error) {\r\n    console.error(\"‚ùå Gagal fetch dari server:\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport default function AttributeTable() {\r\n  const { layerDefinitions, layerVisibility, features: allFeatures, refreshData } = useData();\r\n\r\n  const [data, setData] = useState<any[]>([]);\r\n  const [columns, setColumns] = useState<MRT_ColumnDef<any>[]>([]);\r\n  const [isSyncing, setIsSyncing] = useState(false);\r\n\r\n  // --- Format header kolom ---\r\n  const formatHeader = (key: string) =>\r\n    key\r\n      .replace(/([A-Z])/g, \" $1\") // camelCase ke spasi\r\n      .replace(/^_+/, \"\") // hapus underscore di awal\r\n      .replace(\"geomType\", \"Tipe Geometri\")\r\n      .replace(\"layer\", \"Layer\")\r\n      .trim();\r\n\r\n  // --- Ambil data dari context (frontend) ---\r\n  const getLocalData = () => {\r\n    // Cek null safety\r\n    if (!allFeatures?.features || !layerDefinitions || !layerVisibility) {\r\n      setData([]);\r\n      setColumns([]);\r\n      return [];\r\n    }\r\n\r\n    // Filter layer yang visible\r\n    const visibleLayers = layerDefinitions.filter((layer) => layer && (layerVisibility[layer.id] ?? false));\r\n\r\n    const result: any[] = [];\r\n    const fieldSet = new Set<string>([\"layer\", \"geomType\"]); // minimal kolom\r\n\r\n    visibleLayers.forEach((layer) => {\r\n      if (!layer?.layerType) return;\r\n\r\n      // Filter feature berdasarkan layerType\r\n      const features = allFeatures.features.filter((f: Feature) => f.properties?.layerType === layer.layerType);\r\n\r\n      features.forEach((feature) => {\r\n        const flattened = flattenFeature(feature, layer.name || layer.layerType);\r\n        result.push(flattened);\r\n        Object.keys(flattened).forEach((key) => fieldSet.add(key));\r\n      });\r\n    });\r\n\r\n    // Generate kolom dinamis\r\n    const dynamicColumns: MRT_ColumnDef<any>[] = Array.from(fieldSet)\r\n      .sort((a, b) => {\r\n        if (a === \"layer\") return -1;\r\n        if (b === \"layer\") return 1;\r\n        return a.localeCompare(b);\r\n      })\r\n      .map((key) => ({\r\n        accessorKey: key,\r\n        header: formatHeader(key),\r\n        size: key === \"layer\" ? 140 : key === \"geomType\" ? 120 : 160,\r\n      }));\r\n\r\n    setColumns(dynamicColumns);\r\n    return result;\r\n  };\r\n\r\n  // --- ‚úÖ Auto-sync saat layerVisibility atau data berubah ---\r\n  useEffect(() => {\r\n    const localData = getLocalData();\r\n    setData(localData);\r\n  }, [layerVisibility, allFeatures]);\r\n\r\n  // --- Handler: Refresh dari server (opsional) ---\r\n  const handleForceRefresh = async () => {\r\n    setIsSyncing(true);\r\n\r\n    // Ambil layerType dari layer yang visible\r\n    const visibleLayerTypes = layerDefinitions\r\n      ?.filter((layer) => layer && (layerVisibility[layer.id] ?? false))\r\n      .map((layer) => layer.layerType)\r\n      .filter(Boolean) as string[];\r\n\r\n    if (!visibleLayerTypes?.length) {\r\n      setIsSyncing(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const freshFeatures = await fetchFreshAttributes(visibleLayerTypes);\r\n      if (freshFeatures.length === 0) return;\r\n\r\n      const freshData = freshFeatures.map((f) => flattenFeature(f, layerDefinitions.find((l) => l?.layerType === f.properties?.layerType)?.name || f.properties?.layerType || \"Unknown\"));\r\n      setData(freshData);\r\n    } catch (err) {\r\n      console.warn(\"Gagal fetch dari server, tetap gunakan data lokal\", err);\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n      <MaterialReactTable\r\n        columns={columns}\r\n        data={data}\r\n        enableColumnResizing\r\n        enableColumnOrdering\r\n        enablePinning\r\n        enableRowNumbers\r\n        enablePagination\r\n        enableGlobalFilter\r\n        enableColumnFilters\r\n        initialState={{\r\n          density: \"compact\",\r\n          pagination: { pageSize: 10, pageIndex: 0 },\r\n        }}\r\n        muiTableContainerProps={{\r\n          sx: { maxHeight: \"400px\" },\r\n        }}\r\n        renderTopToolbarCustomActions={() => (\r\n          <Box sx={{ display: \"flex\", gap: \"1rem\", alignItems: \"center\" }}>\r\n            <h3 className=\"text-lg font-semibold\">üìã Attribute Table</h3>\r\n\r\n            {/* Tombol Refresh: hanya untuk force update dari server */}\r\n            <Tooltip title=\"Sinkron ulang dari server\">\r\n              <span>\r\n                <IconButton onClick={handleForceRefresh} disabled={isSyncing} size=\"small\" color=\"primary\">\r\n                  {isSyncing ? <CircularProgress size={20} /> : <Refresh />}\r\n                </IconButton>\r\n              </span>\r\n            </Tooltip>\r\n\r\n            {isSyncing && <Box sx={{ fontSize: \"0.875rem\", color: \"text.secondary\" }}>Memuat data terbaru...</Box>}\r\n          </Box>\r\n        )}\r\n        muiTablePaperProps={{\r\n          elevation: 0,\r\n          sx: {\r\n            borderRadius: \"8px\",\r\n            border: \"1px solid #e0e0e0\",\r\n          },\r\n        }}\r\n        state={{\r\n          showProgressBars: isSyncing, // progress bar di header saat loading\r\n        }}\r\n      />\r\n\r\n      {/* Pesan jika tidak ada data */}\r\n      {data.length === 0 && <Box sx={{ p: 2, color: \"text.secondary\", textAlign: \"center\", fontSize: \"0.9rem\" }}>üì≠ Tidak ada layer yang ditampilkan. Aktifkan layer dari peta untuk melihat atribut.</Box>}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1530, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/components/panels/FeaturePanel.tsx"],"sourcesContent":["// src/components/panels/FeaturePanel.tsx\r\n\"use client\";\r\n\r\nimport { ChangeEvent, useEffect, useState } from \"react\";\r\nimport { useData } from \"@/context/DataContext\";\r\nimport { useTool } from \"@/context/ToolContext\";\r\n\r\ninterface EchosounderPoint {\r\n  jarak: number;\r\n  kedalaman: number;\r\n}\r\n\r\ntype DataType = \"2d\" | \"3d\" | \"gps\" | \"unknown\";\r\n\r\ninterface FeaturePanelProps {\r\n  activePanel: \"rute\" | \"interpolasi\" | \"sbn\" | \"echosounder\";\r\n  close: () => void;\r\n}\r\n\r\n// ‚úÖ Fungsi bantu: Ambil headers otentikasi\r\nconst getAuthHeaders = () => {\r\n  const token = localStorage.getItem(\"authToken\");\r\n  return {\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n  };\r\n};\r\n\r\nexport default function FeaturePanel({ activePanel, close }: FeaturePanelProps) {\r\n  const { echosounderData, setEchosounderData, refreshData, refreshSurveyList } = useData();\r\n  const { setShowSidebarRight, setShowSurface3D } = useTool();\r\n\r\n  const [manualJarak, setManualJarak] = useState(\"\");\r\n  const [manualKedalaman, setManualKedalaman] = useState(\"\");\r\n  const [uploadStatus, setUploadStatus] = useState<{\r\n    loading: boolean;\r\n    type: DataType;\r\n    count: number;\r\n  } | null>(null);\r\n\r\n  // --- Input manual ---\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    const jarak = parseFloat(manualJarak);\r\n    const kedalaman = parseFloat(manualKedalaman);\r\n\r\n    if (isNaN(jarak) || isNaN(kedalaman)) {\r\n      alert(\"‚ùå Jarak dan kedalaman harus angka.\");\r\n      return;\r\n    }\r\n\r\n    setEchosounderData((prev) => [...(Array.isArray(prev) ? prev : []), { jarak, kedalaman }]);\r\n    setManualJarak(\"\");\r\n    setManualKedalaman(\"\");\r\n  };\r\n\r\n  // --- Upload CSV ---\r\n  const handleCSVUpload = (e: ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setUploadStatus({ loading: true, type: \"unknown\", count: 0 });\r\n\r\n    const formData = new FormData();\r\n    formData.append(\"file\", file);\r\n\r\n    fetch(\"http://localhost:5000/api/upload/echosounder\", {\r\n      method: \"POST\",\r\n      body: formData,\r\n      headers: getAuthHeaders(),\r\n    })\r\n      .then((res) => {\r\n        if (!res.ok) {\r\n          throw new Error(`HTTP ${res.status}: ${res.statusText}`);\r\n        }\r\n        return res.json();\r\n      })\r\n      .then((result) => {\r\n        console.log(\"‚úÖ Upload sukses:\", result);\r\n        if (result.success) {\r\n          // ‚úÖ 1. Simpan ke localStorage sebagai riwayat upload\r\n          const savedSurveys = JSON.parse(localStorage.getItem(\"fieldSurveys\") || \"[]\");\r\n          const newSurvey = {\r\n            surveyId: result.surveyId,\r\n            date: new Date().toLocaleDateString(\"id-ID\"),\r\n            count: result.count,\r\n            source: \"import\",\r\n            uploadedAt: new Date().toISOString(),\r\n          };\r\n\r\n          // Hindari duplikat\r\n          const filtered = savedSurveys.filter((s: any) => s.surveyId !== result.surveyId);\r\n          localStorage.setItem(\"fieldSurveys\", JSON.stringify([...filtered, newSurvey]));\r\n\r\n          // ‚úÖ 2. Trigger refresh di SidebarRight\r\n          refreshSurveyList(); // ‚Üê Hanya untuk list di tab \"Data Lapangan\"\r\n          refreshData(); // ‚Üê Untuk sinkron data utama (opsional)\r\n\r\n          alert(`‚úÖ ${result.count} titik berhasil diimpor sebagai ${result.surveyId}`);\r\n        } else {\r\n          alert(`‚ùå Upload gagal: ${result.error}`);\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"‚ùå Gagal upload:\", err);\r\n        alert(`‚ùå Gagal upload: ${err.message}`);\r\n      })\r\n      .finally(() => {\r\n        setUploadStatus(null);\r\n        e.target.value = \"\";\r\n      });\r\n  };\r\n\r\n  // --- Sinkronisasi ke localStorage ---\r\n  useEffect(() => {\r\n    if (Array.isArray(echosounderData)) {\r\n      try {\r\n        localStorage.setItem(\"echosounderData\", JSON.stringify(echosounderData));\r\n      } catch (err) {\r\n        console.warn(\"Gagal simpan ke localStorage:\", err);\r\n      }\r\n    }\r\n  }, [echosounderData]);\r\n\r\n  useEffect(() => () => setUploadStatus(null), []);\r\n\r\n  return (\r\n    <div className=\"absolute top-4 left-1/2 -translate-x-1/2 w-[480px] bg-white rounded-xl shadow-2xl p-5 z-50 overflow-auto max-h-[90vh] border border-gray-200\">\r\n      <div className=\"flex justify-between items-center mb-4 pb-3 border-b border-gray-100\">\r\n        <h3 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\r\n          {activePanel === \"echosounder\" && \"üìä\"} {panelTitle[activePanel]}\r\n        </h3>\r\n        <button onClick={close} className=\"text-red-500 hover:text-red-600 hover:bg-red-50 rounded-full p-1 transition-all\" aria-label=\"Tutup\">\r\n          ‚úï\r\n        </button>\r\n      </div>\r\n\r\n      {activePanel === \"echosounder\" && (\r\n        <div className=\"space-y-5\">\r\n          <p className=\"text-sm text-gray-600\">Masukkan data kedalaman manual atau unggah file CSV.</p>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-3 bg-gray-50 p-4 rounded-lg border\">\r\n            <h4 className=\"font-medium text-slate-700\">‚ûï Input Manual</h4>\r\n            <div className=\"grid grid-cols-2 gap-3\">\r\n              <div>\r\n                <label className=\"text-xs text-slate-600\">Jarak (m)</label>\r\n                <input type=\"number\" step=\"any\" value={manualJarak} onChange={(e) => setManualJarak(e.target.value)} required className=\"w-full border rounded px-3 py-2 text-sm\" placeholder=\"50.5\" />\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs text-slate-600\">Kedalaman (m)</label>\r\n                <input type=\"number\" step=\"any\" value={manualKedalaman} onChange={(e) => setManualKedalaman(e.target.value)} required className=\"w-full border rounded px-3 py-2 text-sm\" placeholder=\"2.3\" />\r\n              </div>\r\n            </div>\r\n            <button type=\"submit\" className=\"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-500 text-sm font-medium\">\r\n              Tambah Titik\r\n            </button>\r\n          </form>\r\n\r\n          <div className=\"bg-blue-50 p-4 rounded-lg border border-blue-200\">\r\n            <h4 className=\"font-medium text-slate-700 mb-1\">üìÅ Unggah CSV</h4>\r\n            <input type=\"file\" accept=\".csv\" onChange={handleCSVUpload} className=\"text-sm block w-full\" />\r\n            {uploadStatus?.loading && <p className=\"text-xs text-blue-600 mt-2\">üîÑ Memproses file...</p>}\r\n            {uploadStatus && !uploadStatus.loading && (\r\n              <p className=\"mt-2 text-xs text-green-600\">\r\n                ‚úÖ {uploadStatus.count} titik dimuat sebagai <b>{uploadStatus.type.toUpperCase()}</b>\r\n              </p>\r\n            )}\r\n            <a href=\"/template_echosounder.csv\" download className=\"text-xs text-blue-600 hover:underline block mt-2\">\r\n              üì• Download Template CSV\r\n            </a>\r\n          </div>\r\n\r\n          <div className=\"flex gap-2 pt-3 border-t\">\r\n            <button\r\n              onClick={() => {\r\n                setShowSidebarRight(true);\r\n                close();\r\n              }}\r\n              className=\"flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-500 text-sm font-medium\"\r\n            >\r\n              üìà Tampilkan 2D\r\n            </button>\r\n            <button\r\n              onClick={() => {\r\n                setShowSurface3D(true);\r\n                close();\r\n              }}\r\n              className=\"flex-1 bg-purple-600 text-white py-2 rounded hover:bg-purple-500 text-sm font-medium\"\r\n            >\r\n              üåê Buka 3D\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// --- Helper Judul Panel ---\r\nconst panelTitle = {\r\n  rute: \"Input Data Rute Survey\",\r\n  interpolasi: \"Interpolasi Data Batimetri\",\r\n  sbn: \"Sarana Bantu Navigasi\",\r\n  echosounder: \"Visualisasi Echosounder\",\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1925, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/components/utils/BasemapSwitcher.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport Image from \"next/image\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\n\r\ntype Props = {\r\n  onChange: (type: string) => void;\r\n  current: string;\r\n  defaultPosition?: { x: number; y: number };\r\n};\r\n\r\nexport default function BasemapSwitcher({ onChange, current, defaultPosition }: Props) {\r\n  const basemaps = [\r\n    { id: \"osm\", label: \"OSM\", icon: \"/icons/map1.png\" },\r\n    { id: \"satellite\", label: \"Satellite\", icon: \"/icons/map2.png\" },\r\n    { id: \"terrain\", label: \"Terrain\", icon: \"/icons/map3.png\" },\r\n  ];\r\n\r\n  const active = basemaps.find((b) => b.id === current) || basemaps[0];\r\n\r\n  const panelRef = useRef<HTMLDivElement>(null);\r\n  const dragRef = useRef<HTMLDivElement>(null);\r\n  const isDragging = useRef(false);\r\n  const offset = useRef({ x: 0, y: 0 });\r\n\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const [position, setPosition] = useState<{ x: number; y: number }>(() => {\r\n    if (defaultPosition) return defaultPosition;\r\n    if (typeof window !== \"undefined\") {\r\n      const bottomPadding = 100; // default offset above location button\r\n      return { x: 20, y: window.innerHeight - bottomPadding };\r\n    }\r\n    return { x: 1900, y: 3000 }; // fallback\r\n  });\r\n\r\n  // Click outside to close\r\n  useEffect(() => {\r\n    function handleClickOutside(event: MouseEvent) {\r\n      if (panelRef.current && !panelRef.current.contains(event.target as Node)) {\r\n        setOpen(false);\r\n      }\r\n    }\r\n\r\n    if (open) {\r\n      document.addEventListener(\"mousedown\", handleClickOutside);\r\n    }\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, [open]);\r\n\r\n  // Drag logic\r\n  useEffect(() => {\r\n    function handleMouseMove(e: MouseEvent) {\r\n      if (!isDragging.current) return;\r\n      setPosition({\r\n        x: e.clientX - offset.current.x,\r\n        y: e.clientY - offset.current.y,\r\n      });\r\n    }\r\n\r\n    function handleMouseUp() {\r\n      isDragging.current = false;\r\n    }\r\n\r\n    window.addEventListener(\"mousemove\", handleMouseMove);\r\n    window.addEventListener(\"mouseup\", handleMouseUp);\r\n    return () => {\r\n      window.removeEventListener(\"mousemove\", handleMouseMove);\r\n      window.removeEventListener(\"mouseup\", handleMouseUp);\r\n    };\r\n  }, []);\r\n\r\n  function handleMouseDown(e: React.MouseEvent) {\r\n    if (!dragRef.current) return;\r\n    isDragging.current = true;\r\n    const rect = dragRef.current.getBoundingClientRect();\r\n    offset.current = {\r\n      x: e.clientX - rect.left,\r\n      y: e.clientY - rect.top,\r\n    };\r\n  }\r\n\r\n  return (\r\n    <div ref={dragRef} className=\"fixed z-[999] cursor-grab\" style={{ top: position.y, left: position.x }} onMouseDown={handleMouseDown}>\r\n      <div ref={panelRef} className=\"relative\">\r\n        <button onClick={() => setOpen(!open)} className=\"bg-white/90 p-1 rounded-full border shadow hover:scale-105 transition\" title=\"Pilih Basemap\">\r\n          <Image src={active.icon} alt={active.label} width={40} height={40} />\r\n        </button>\r\n\r\n        <AnimatePresence>\r\n          {open && (\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.8, x: -30, y: -10 }}\r\n              animate={{ opacity: 1, scale: 1, x: 0, y: 0 }}\r\n              exit={{ opacity: 0, scale: 0.8, x: -30, y: -10 }}\r\n              transition={{ duration: 0.2 }}\r\n              className=\"absolute right-0 top-0 mt-3 mr-2 bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg ring-1 ring-black/5 p-1 flex flex-row gap-1\"\r\n            >\r\n              {basemaps.map((base) => (\r\n                <button\r\n                  key={base.id}\r\n                  onClick={() => {\r\n                    onChange(base.id);\r\n                    setOpen(false);\r\n                  }}\r\n                  className={`flex flex-col items-center justify-center px-2 py-1.5 rounded-xl hover:bg-cyan-50 transition-all duration-200 ${current === base.id ? \"bg-cyan-100 font-semibold\" : \"\"}`}\r\n                >\r\n                  <div className=\"w-6 h-6 relative\">\r\n                    <Image src={base.icon} alt={base.label} fill className=\"object-contain\" />\r\n                  </div>\r\n                  <span className=\"text-[10px] text-gray-700 mt-1 leading-none\">{base.label}</span>\r\n                </button>\r\n              ))}\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2160, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/components/PanelToggler.tsx"],"sourcesContent":["import { LayoutPanelLeft, LayoutPanelTop } from \"lucide-react\";\r\nimport { MdViewSidebar } from \"react-icons/md\";\r\n\r\ninterface PanelTogglerProps {\r\n  onToggleLeft: () => void;\r\n  onToggleRight: () => void;\r\n  onToggleBottom: () => void;\r\n}\r\n\r\nexport default function PanelToggler({ onToggleLeft, onToggleRight, onToggleBottom }: PanelTogglerProps) {\r\n  return (\r\n    <div className=\"absolute top-4 right-4 z-30 flex flex-col gap-2\">\r\n      <button onClick={onToggleLeft} className=\"bg-white/70 backdrop-blur border border-gray-300 rounded-lg shadow p-2 hover:bg-white transition\" title=\"Toggle Sidebar Kiri\" aria-label=\"Toggle Sidebar Kiri\">\r\n        <LayoutPanelLeft className=\"w-5 h-5 text-gray-700\" />\r\n      </button>\r\n\r\n      <button onClick={onToggleRight} className=\"bg-white/70 backdrop-blur border border-gray-300 rounded-lg shadow p-2 hover:bg-white transition\" title=\"Toggle Sidebar Kanan\" aria-label=\"Toggle Sidebar Kanan\">\r\n        <MdViewSidebar className=\"w-5 h-5 text-gray-700 rotate-180\" />\r\n      </button>\r\n\r\n      <button onClick={onToggleBottom} className=\"bg-white/70 backdrop-blur border border-gray-300 rounded-lg shadow p-2 hover:bg-white transition\" title=\"Toggle Panel Bawah\" aria-label=\"Toggle Panel Bawah\">\r\n        <LayoutPanelTop className=\"w-5 h-5 text-gray-700 rotate-180\" />\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;;AAQe,SAAS,aAAa,EAAE,YAAY,EAAE,aAAa,EAAE,cAAc,EAAqB;IACrG,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAO,SAAS;gBAAc,WAAU;gBAAmG,OAAM;gBAAsB,cAAW;0BACjL,cAAA,6LAAC,mOAAA,CAAA,kBAAe;oBAAC,WAAU;;;;;;;;;;;0BAG7B,6LAAC;gBAAO,SAAS;gBAAe,WAAU;gBAAmG,OAAM;gBAAuB,cAAW;0BACnL,cAAA,6LAAC,iJAAA,CAAA,gBAAa;oBAAC,WAAU;;;;;;;;;;;0BAG3B,6LAAC;gBAAO,SAAS;gBAAgB,WAAU;gBAAmG,OAAM;gBAAqB,cAAW;0BAClL,cAAA,6LAAC,iOAAA,CAAA,iBAAc;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAIlC;KAhBwB","debugId":null}},
    {"offset": {"line": 2244, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/components/SamplingBottomSidebar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useTool } from \"@/context/ToolContext\";\r\n\r\ninterface Props {\r\n  visible: boolean;\r\n  onClose?: () => void;\r\n}\r\n\r\nexport default function SamplingBottomSidebar({ visible, onClose }: Props) {\r\n  const { samplingPoints = [], samplingSummary, samplingUpdatedAt } = useTool();\r\n  const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (visible && samplingUpdatedAt) {\r\n      setShowSuccess(true);\r\n      const timer = setTimeout(() => setShowSuccess(false), 3000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [samplingUpdatedAt, visible]);\r\n\r\n  if (!visible || !samplingSummary) return null;\r\n\r\n  const { panjang, kedalamanAvg, lebarAvg, jumlahTitik } = samplingSummary;\r\n\r\n  return (\r\n    <div className=\"fixed bottom-0 left-0 right-0 bg-white border-t-2 border-blue-500 p-4 z-[999] shadow-lg text-gray-900\">\r\n      <div className=\"max-w-5xl mx-auto text-sm\">\r\n        <div className=\"flex justify-between items-center mb-2\">\r\n          <h3 className=\"font-semibold text-base text-gray-900\">üß™ Informasi Sampling</h3>\r\n          {onClose && (\r\n            <button className=\"text-sm text-red-600 hover:underline\" onClick={onClose}>\r\n              ‚ùå Tutup\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {showSuccess && <div className=\"mb-3 text-green-800 bg-green-100 border border-green-300 px-4 py-2 rounded-md animate-fade-in\">‚úÖ Sampling berhasil dibuat!</div>}\r\n\r\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4 text-gray-800\">\r\n          <div>\r\n            üìè Panjang Sungai: <strong className=\"text-black\">{Number.isFinite(panjang) ? panjang.toFixed(2) : \"-\"}</strong> m\r\n          </div>\r\n          <div>\r\n            üåä Kedalaman Rata-rata: <strong className=\"text-black\">{Number.isFinite(kedalamanAvg) ? kedalamanAvg.toFixed(1) : \"-\"}</strong> m\r\n          </div>\r\n          <div>\r\n            üìê Lebar Rata-rata: <strong className=\"text-black\">{Number.isFinite(lebarAvg) ? lebarAvg.toFixed(1) : \"-\"}</strong> m\r\n          </div>\r\n          <div>\r\n            üéØ Jumlah Titik: <strong className=\"text-black\">{jumlahTitik ?? \"-\"}</strong>\r\n          </div>\r\n        </div>\r\n\r\n        {Array.isArray(samplingPoints) && samplingPoints.length > 0 && (\r\n          <details className=\"mt-3\">\r\n            <summary className=\"cursor-pointer text-blue-700 hover:underline\">üîò Lihat 5 koordinat pertama</summary>\r\n            <ol className=\"list-decimal list-inside mt-2 max-h-32 overflow-y-auto text-xs bg-gray-100 p-2 rounded text-gray-800\">\r\n              {samplingPoints.slice(0, 5).map((pt, i) => {\r\n                const [lng, lat] = pt?.geometry?.coordinates ?? [null, null];\r\n                return <li key={i}>{lat != null && lng != null ? `${lat.toFixed(5)}, ${lng.toFixed(5)}` : \"Koordinat tidak tersedia\"}</li>;\r\n              })}\r\n            </ol>\r\n          </details>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAHA;;;AAUe,SAAS,sBAAsB,EAAE,OAAO,EAAE,OAAO,EAAS;;IACvE,MAAM,EAAE,iBAAiB,EAAE,EAAE,eAAe,EAAE,iBAAiB,EAAE,GAAG,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD;IAC1E,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAE/C,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;2CAAE;YACR,IAAI,WAAW,mBAAmB;gBAChC,eAAe;gBACf,MAAM,QAAQ;6DAAW,IAAM,eAAe;4DAAQ;gBACtD;uDAAO,IAAM,aAAa;;YAC5B;QACF;0CAAG;QAAC;QAAmB;KAAQ;IAE/B,IAAI,CAAC,WAAW,CAAC,iBAAiB,OAAO;IAEzC,MAAM,EAAE,OAAO,EAAE,YAAY,EAAE,QAAQ,EAAE,WAAW,EAAE,GAAG;IAEzD,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAAwC;;;;;;wBACrD,yBACC,6LAAC;4BAAO,WAAU;4BAAuC,SAAS;sCAAS;;;;;;;;;;;;gBAM9E,6BAAe,6LAAC;oBAAI,WAAU;8BAAgG;;;;;;8BAE/H,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;;gCAAI;8CACgB,6LAAC;oCAAO,WAAU;8CAAc,OAAO,QAAQ,CAAC,WAAW,QAAQ,OAAO,CAAC,KAAK;;;;;;gCAAa;;;;;;;sCAElH,6LAAC;;gCAAI;8CACqB,6LAAC;oCAAO,WAAU;8CAAc,OAAO,QAAQ,CAAC,gBAAgB,aAAa,OAAO,CAAC,KAAK;;;;;;gCAAa;;;;;;;sCAEjI,6LAAC;;gCAAI;8CACiB,6LAAC;oCAAO,WAAU;8CAAc,OAAO,QAAQ,CAAC,YAAY,SAAS,OAAO,CAAC,KAAK;;;;;;gCAAa;;;;;;;sCAErH,6LAAC;;gCAAI;8CACc,6LAAC;oCAAO,WAAU;8CAAc,eAAe;;;;;;;;;;;;;;;;;;gBAInE,MAAM,OAAO,CAAC,mBAAmB,eAAe,MAAM,GAAG,mBACxD,6LAAC;oBAAQ,WAAU;;sCACjB,6LAAC;4BAAQ,WAAU;sCAA+C;;;;;;sCAClE,6LAAC;4BAAG,WAAU;sCACX,eAAe,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,IAAI;gCACnC,MAAM,CAAC,KAAK,IAAI,GAAG,IAAI,UAAU,eAAe;oCAAC;oCAAM;iCAAK;gCAC5D,qBAAO,6LAAC;8CAAY,OAAO,QAAQ,OAAO,OAAO,GAAG,IAAI,OAAO,CAAC,GAAG,EAAE,EAAE,IAAI,OAAO,CAAC,IAAI,GAAG;mCAA1E;;;;;4BAClB;;;;;;;;;;;;;;;;;;;;;;;AAOd;GA3DwB;;QAC8C,iIAAA,CAAA,UAAO;;;KADrD","debugId":null}},
    {"offset": {"line": 2462, "column": 0}, "map": {"version":3,"sources":["file:///D:/MY%20Data/kerjaan/2025/SUNGAI%20MUSI%20PALEMBANG/my%20project/frontend/src/app/map/page-inner.tsx"],"sourcesContent":["// src/app/map/page-inner.tsx\r\n\"use client\"; // 1. Pastikan ini adalah Client Component\r\n\r\nimport dynamic from \"next/dynamic\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport HeaderBar from \"@/components/HeaderBar\";\r\nimport SidebarLeft from \"@/components/SidebarLeft\";\r\nimport SidebarRight from \"@/components/SidebarRight\";\r\nimport BottomPanel from \"@/components/BottomPanel\";\r\nimport FeaturePanel from \"@/components/panels/FeaturePanel\";\r\n// 2. Perbaiki path import BasemapSwitcher jika diperlukan\r\n//    (jika file dipindah ke folder components/utils/)\r\nimport BasemapSwitcher from \"@/components/utils/BasemapSwitcher\";\r\nimport PanelToggler from \"@/components/PanelToggler\";\r\nimport SamplingBottomSidebar from \"@/components/SamplingBottomSidebar\";\r\nimport { useTool } from \"@/context/ToolContext\"; // 3. Gunakan ToolContext untuk state tools/UI\r\n// 4. Impor useData untuk memastikan SidebarRight bisa mengakses echosounderData jika diperlukan\r\n//    (meskipun dalam implementasi terbaru SidebarRight langsung menggunakan useData,\r\n//     mengimpornya di sini tidak merugikan dan bisa memberikan gambaran ketergantungan)\r\n// import { useData } from \"@/context/DataContext\";\r\nimport { Map } from \"leaflet\";\r\n// 5. HAPUS import SimulasiPanel dan ToponimiFormModal dari sini karena akan dihandle MapComponent\r\n// import SimulasiPanel from \"@/components/panels/SimulasiPanel\";\r\n// import ToponimiFormModal from \"@/components/forms/ToponimiFormModal\";\r\n// import type { Tool } from \"@/context/ToolContext\"; // Tidak digunakan secara langsung di sini\r\n\r\n// 6. Impor MapComponent secara dinamis untuk menghindari masalah SSR dengan Leaflet\r\nconst MapComponent = dynamic(() => import(\"@/components/map/MapComponent\"), {\r\n  ssr: false,\r\n});\r\n\r\nexport default function MapPageInner() {\r\n  const [latlng, setLatLng] = useState<[number, number]>([0, 0]);\r\n  const [userLocation, setUserLocation] = useState<[number, number] | null>(null);\r\n  const [basemapType, setBasemapType] = useState(\"osm\");\r\n\r\n  const [leftVisible, setLeftVisible] = useState(true);\r\n  const [bottomVisible, setBottomVisible] = useState(false);\r\n  const [bottomHeight, setBottomHeight] = useState(300);\r\n  const [rightWidth, setRightWidth] = useState(384);\r\n  const [showSamplingInfo, setShowSamplingInfo] = useState(false);\r\n\r\n  const mapRef = useRef<Map | null>(null);\r\n\r\n  // 7. Gunakan state dan fungsi dari ToolContext\r\n  const { showSidebarRight, setShowSidebarRight, samplingUpdatedAt, activeTool, setActiveTool } = useTool();\r\n  // 8. Gunakan state dan fungsi dari DataContext jika diperlukan di level ini\r\n  // const { features, loading, error } = useData();\r\n\r\n  // 9. Efek untuk menampilkan SamplingBottomSidebar saat sampling selesai\r\n  useEffect(() => {\r\n    if (samplingUpdatedAt) {\r\n      setShowSamplingInfo(true);\r\n    }\r\n  }, [samplingUpdatedAt]);\r\n\r\n  // 10. Efek untuk memperbarui ukuran peta saat panel diubah\r\n  useEffect(() => {\r\n    if (mapRef.current) {\r\n      // Timeout kecil untuk memastikan DOM sudah diperbarui\r\n      setTimeout(() => {\r\n        mapRef.current?.invalidateSize();\r\n      }, 300);\r\n    }\r\n  }, [leftVisible, showSidebarRight, bottomVisible, bottomHeight, rightWidth]);\r\n\r\n  // 11. Fungsi untuk mendapatkan lokasi pengguna\r\n  const handleLocateMe = () => {\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          const { latitude, longitude } = position.coords;\r\n          setUserLocation([latitude, longitude]);\r\n          // 12. Fokuskan peta ke lokasi pengguna\r\n          mapRef.current?.setView([latitude, longitude], 14);\r\n        },\r\n        (error) => {\r\n          alert(\"Gagal mendapatkan lokasi: \" + error.message);\r\n        }\r\n      );\r\n    } else {\r\n      alert(\"Geolocation tidak didukung di browser ini.\");\r\n    }\r\n  };\r\n\r\n  // 13. Fungsi untuk menangani proses echosounder (membuka sidebar kanan)\r\n  //     Fungsi ini dikirim ke FeaturePanel sebagai prop 'onEchosounderProses'.\r\n  //     Namun, karena FeaturePanel sekarang bisa langsung menggunakan useData\r\n  //     dan memanggil setShowSidebarRight, prop ini mungkin tidak terlalu diperlukan lagi.\r\n  //     Tapi kita tetap pertahankan untuk kompatibilitas atau jika ada logika tambahan.\r\n  const handleEchosounderProses = () => {\r\n    // 14. Buka sidebar kanan untuk menampilkan hasil echosounder\r\n    //     (Tidak perlu menutup tool, karena FeaturePanel bisa melakukannya sendiri jika perlu)\r\n    // setActiveTool(null); // Opsional, tergantung desain UX\r\n    setShowSidebarRight(true);\r\n  };\r\n\r\n  return (\r\n    <main className=\"flex flex-col h-screen overflow-hidden\">\r\n      {/* 15. Header aplikasi */}\r\n      <HeaderBar />\r\n\r\n      {/* 16. Kontainer utama untuk konten (peta dan panel) */}\r\n      <div className=\"flex flex-1 relative overflow-hidden bg-gray-200\">\r\n        {/* 17. Sidebar kiri */}\r\n        {leftVisible && (\r\n          <div className=\"w-72 bg-white border-r border-gray-200 z-20\">\r\n            <SidebarLeft />\r\n          </div>\r\n        )}\r\n\r\n        {/* 18. Area konten utama (peta) */}\r\n        <div className=\"flex-1 relative h-full overflow-hidden\">\r\n          {/* 19. Komponen peta utama */}\r\n          <div className=\"absolute inset-0 z-0\">\r\n            <MapComponent setLatLng={setLatLng} basemapType={basemapType} mapRef={mapRef} userLocation={userLocation} />\r\n          </div>\r\n\r\n          {/* 20. Sidebar informasi sampling */}\r\n          <SamplingBottomSidebar visible={showSamplingInfo} onClose={() => setShowSamplingInfo(false)} />\r\n\r\n          {/* 21. Koordinat mouse di pojok kiri bawah */}\r\n          <div className=\"absolute bottom-2 left-2 bg-blue-500 text-xs px-3 py-1 rounded shadow text-white z-10\">\r\n            Lat: {latlng[0].toFixed(5)}, Lng: {latlng[1].toFixed(5)}\r\n          </div>\r\n\r\n          {/* 22. Tombol lokasi pengguna di pojok kanan bawah */}\r\n          <div className=\"absolute bottom-32 right-2 z-10\">\r\n            <button onClick={handleLocateMe} className=\"bg-blue-600 text-white p-3 rounded-full shadow-xl hover:bg-blue-700 transition-all duration-200 hover:scale-110 relative\" title=\"Lokasi Saya\">\r\n              {/* Pulse Animation */}\r\n              <div className=\"absolute inset-0 rounded-full bg-blue-600 animate-ping opacity-75\"></div>\r\n\r\n              <div className=\"relative z-10\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                  <path fillRule=\"evenodd\" d=\"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n              </div>\r\n            </button>\r\n          </div>\r\n\r\n          {/* 23. Switcher basemap */}\r\n          <BasemapSwitcher onChange={setBasemapType} current={basemapType} defaultPosition={{ x: 1810, y: 210 }} />\r\n\r\n          {/* 24. === FEATURE PANEL === */}\r\n          {/* Perbarui props yang dikirim ke FeaturePanel */}\r\n          {/* Hapus prop 'onEchosounderProses' jika FeaturePanel tidak memerlukannya lagi */}\r\n          {/* Tambahkan prop 'setShowSidebarRight' jika FeaturePanel perlu mengontrol sidebar kanan secara langsung */}\r\n          {activeTool === \"echosounder\" && (\r\n            <FeaturePanel\r\n              activePanel=\"echosounder\"\r\n              close={() => setActiveTool(null)}\r\n              // onEchosounderProses={handleEchosounderProses} // Opsional, bisa dihapus\r\n              // setShowSidebarRight={setShowSidebarRight} // Jika FeaturePanel butuh ini, tambahkan sebagai props\r\n            />\r\n          )}\r\n\r\n          {/* \r\n            25. === SIMULASI PANEL & TOPONIMI FORM MODAL === \r\n            DIHAPUS/KOMENTARI karena akan dihandle oleh MapComponent.\r\n            MapComponent memiliki semua state dan logika yang diperlukan untuk \r\n            membuat SimulasiPanel dan ToponimiFormModal berfungsi dengan benar.\r\n            Mereka tidak lagi dirender secara langsung oleh MapPageInner.\r\n          */}\r\n          {/* \r\n          {activeTool === \"simulasi\" && <SimulasiPanel onGenerate={() => {}} onStartDrawing={() => {}} isDrawing={false} hasLine={false} onDeleteLine={() => {}} onClosePanel={() => setActiveTool(null)} />}\r\n          {activeTool === \"toponimi\" && (\r\n            <ToponimiFormModal\r\n              initialLatLng={latlng}\r\n              onSubmit={(lat, lng, name) => {\r\n                console.log(\"Toponimi submitted:\", { lat, lng, name });\r\n              }}\r\n              onClosePanel={() => setActiveTool(null)}\r\n            />\r\n          )} \r\n          */}\r\n\r\n          {/* 26. Tombol toggle panel */}\r\n          <PanelToggler onToggleLeft={() => setLeftVisible(!leftVisible)} onToggleRight={() => setShowSidebarRight((prev) => !prev)} onToggleBottom={() => setBottomVisible(!bottomVisible)} />\r\n        </div>\r\n\r\n        {/* 27. Sidebar kanan */}\r\n        {showSidebarRight && (\r\n          <>\r\n            {/* 28. Handle untuk mengubah ukuran sidebar kanan */}\r\n            <div\r\n              onMouseDown={(e) => {\r\n                const startX = e.clientX;\r\n                const startWidth = rightWidth;\r\n\r\n                const handleMouseMove = (moveEvent: MouseEvent) => {\r\n                  const newWidth = Math.max(240, startWidth - (moveEvent.clientX - startX));\r\n                  setRightWidth(newWidth);\r\n                };\r\n\r\n                const handleMouseUp = () => {\r\n                  window.removeEventListener(\"mousemove\", handleMouseMove);\r\n                  window.removeEventListener(\"mouseup\", handleMouseUp);\r\n                };\r\n\r\n                window.addEventListener(\"mousemove\", handleMouseMove);\r\n                window.addEventListener(\"mouseup\", handleMouseUp);\r\n              }}\r\n              className=\"w-2 cursor-col-resize bg-gray-300 z-30\"\r\n            />\r\n            <div className=\"bg-white border-l border-gray-200 z-20 h-full overflow-hidden\" style={{ width: `${rightWidth}px` }}>\r\n              <SidebarRight />\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* 29. Panel bawah */}\r\n      {bottomVisible && (\r\n        <>\r\n          {/* 30. Handle untuk mengubah ukuran panel bawah */}\r\n          <div\r\n            onMouseDown={(e) => {\r\n              const startY = e.clientY;\r\n              const startHeight = bottomHeight;\r\n\r\n              const handleMouseMove = (moveEvent: MouseEvent) => {\r\n                const newHeight = Math.max(120, startHeight + (startY - moveEvent.clientY));\r\n                setBottomHeight(newHeight);\r\n              };\r\n\r\n              const handleMouseUp = () => {\r\n                window.removeEventListener(\"mousemove\", handleMouseMove);\r\n                window.removeEventListener(\"mouseup\", handleMouseUp);\r\n              };\r\n\r\n              window.addEventListener(\"mousemove\", handleMouseMove);\r\n              window.addEventListener(\"mouseup\", handleMouseUp);\r\n            }}\r\n            className=\"h-2 cursor-row-resize bg-gray-300 z-30\"\r\n          />\r\n          <div className=\"bg-white border-t border-gray-300 z-20 overflow-hidden\" style={{ height: `${bottomHeight}px` }}>\r\n            <BottomPanel />\r\n          </div>\r\n        </>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}